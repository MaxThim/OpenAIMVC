<div>
    <label id="listbox-label" style="font-size: 0.875rem; line-height: 1.5rem; font-weight: 500; color: #374151;">Assigned to</label>
    <div style="position: relative; margin-top: 0.5rem;">
        <button type="button" style="position: relative; width: 100%; cursor: default; border-radius: 0.375rem; background-color: #fff; padding-top: 0.375rem; padding-bottom: 0.375rem; padding-left: 0.75rem; padding-right: 2.5rem; color: #374151; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05), 0 1px 1px 0 rgba(0, 0, 0, 0.1); border: 1px solid #D1D5DB; outline: none; transition: background-color 150ms ease-in-out, border-color 150ms ease-in-out, box-shadow 150ms ease-in-out;" aria-haspopup="listbox" aria-expanded="true" aria-labelledby="listbox-label">
            <span style="display: inline-flex; width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                <span style="overflow: hidden; text-overflow: ellipsis;">Tom Cook</span>
                <span style="margin-left: 0.5rem; overflow: hidden; text-overflow: ellipsis; color: #6B7280;">@@tomcook</span>
            </span>
            <span style="pointer-events: none; position: absolute; top: 50%; transform: translateY(-50%); right: 0.75rem; display: flex; align-items: center;">
                <svg style="height: 1.25rem; width: 1.25rem; color: #9CA3AF;" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M10 3a.75.75 0 01.55.24l3.25 3.5a.75.75 0 11-1.1 1.02L10 4.852 7.3 7.76a.75.75 0 01-1.1-1.02l3.25-3.5A.75.75 0 0110 3zm-3.76 9.2a.75.75 0 011.06.04l2.7 2.908 2.7-2.908a.75.75 0 111.1 1.02l-3.25 3.5a.75.75 0 01-1.1 0l-3.25-3.5a.75.75 0 01.04-1.06z" clip-rule="evenodd" />
                </svg>
            </span>
        </button>

        <!--
          Select popover, show/hide based on select state.

          Entering: ""
            From: ""
            To: ""
          Leaving: "transition ease-in duration-100"
            From: "opacity-100"
            To: "opacity-0"
        -->
        <ul style="position: absolute; z-index: 10; margin-top: 0.125rem; max-height: 3.75rem; width: 100%; overflow: auto; border-radius: 0.375rem; background-color: #fff; padding-top: 0.25rem; padding-bottom: 0.25rem; padding-left: 0.75rem; padding-right: 0.75rem; color: #374151; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05), 0 1px 1px 0 rgba(0, 0, 0, 0.1); border: 1px solid #000; outline: none; transition: opacity 150ms ease-in-out; visibility: hidden; opacity: 0;" tabindex="-1" role="listbox" aria-labelledby="listbox-label" aria-activedescendant="listbox-option-3">
            <!--
              Select option, manage highlight styles based on mouseenter/mouseleave and keyboard navigation.

              Highlighted: "bg-indigo-600 text-white", Not Highlighted: "text-gray-900"
            -->
            <li style="font-size: 0.875rem; line-height: 1.25rem; font-weight: 400; color: #374151; position: relative; cursor: default; user-select: none; padding-top: 0.5rem; padding-bottom: 0.5rem; padding-left: 0.75rem; padding-right: 2.25rem; transition: background-color 150ms ease-in-out;">
                <div style="display: flex;">
                    <!-- Selected: "font-semibold", Not Selected: "font-normal" -->
                    <span style="overflow: hidden; text-overflow: ellipsis;">Wade Cooper</span>
                    <!-- Highlighted: "text-indigo-200", Not Highlighted: "text-gray-500" -->
                    <span style="margin-left: 0.5rem; overflow: hidden; text-overflow: ellipsis; color: #6B7280;">@@wadecooper</span>
                </div>

                <div style="display: flex;">
                    <!-- Selected: "font-semibold", Not Selected: "font-normal" -->
                    <span style="overflow: hidden; text-overflow: ellipsis;">Johnny</span>
                    <!-- Highlighted: "text-indigo-200", Not Highlighted: "text-gray-500" -->
                    <span style="margin-left: 0.5rem; overflow: hidden; text-overflow: ellipsis; color: #6B7280;">@@Johnnyyyyyy</span>
                </div>

                <!--
                  Checkmark, only display for selected option.

                  Highlighted: "text-white", Not Highlighted: "text-indigo-600"
                -->
                <span style="position: absolute; top: 50%; transform: translateY(-50%); right: 0.75rem; display: flex; align-items: center;">
                    <svg style="height: 1.25rem; width: 1.25rem; color: #4F46E5;" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                    </svg>
                </span>
            </li>

            <!-- More items... -->
        </ul>
    </div>
</div>

<script>
    const button = document.querySelector('button[aria-haspopup="listbox"]');
    const listbox = document.querySelector('ul[role="listbox"]');
    const options = listbox.querySelectorAll('li');
    let selectedOption = null;

    function toggleListbox() {
        const expanded = button.getAttribute('aria-expanded') === 'true';
        button.setAttribute('aria-expanded', !expanded);
        listbox.style.opacity = expanded ? 0 : 1;
        listbox.style.visibility = expanded ? 'hidden' : 'visible';
    }

    function setSelectedOption(option) {
        if (selectedOption) {
            selectedOption.classList.remove('bg-indigo-600', 'text-white');
        }
        option.classList.add('bg-indigo-600', 'text-white');
        button.querySelector('span:first-child').textContent = option.querySelector('span:first-child').textContent;
        selectedOption = option;
    }

    button.addEventListener('click', toggleListbox);

    options.forEach(option => {
        option.addEventListener('click', () => {
            setSelectedOption(option);
            toggleListbox();
        });
        option.addEventListener('mouseenter', () => {
            option.classList.add('bg-gray-100');
        });
        option.addEventListener('mouseleave', () => {
            option.classList.remove('bg-gray-100');
        });
        option.addEventListener('keydown', event => {
            if (event.code === 'Space' || event.code === 'Enter') {
                setSelectedOption(option);
                toggleListbox();
            }
        });
    });

    listbox.addEventListener('keydown', event => {
        if (event.code === 'Escape') {
            toggleListbox();
            button.focus();
        } else if (event.code === 'ArrowUp') {
            const index = Array.from(options).indexOf(selectedOption);
            const prevIndex = index > 0 ? index - 1 : options.length - 1;
            setSelectedOption(options[prevIndex]);
            options[prevIndex].scrollIntoView({ block: 'nearest' });
        } else if (event.code === 'ArrowDown') {
            const index = Array.from(options).indexOf(selectedOption);
            const nextIndex = index < options.length - 1 ? index + 1 : 0;
            setSelectedOption(options[nextIndex]);
            options[nextIndex].scrollIntoView({ block: 'nearest' });
        }
    });
</script>